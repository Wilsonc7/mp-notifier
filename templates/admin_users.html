{% extends "_base.html" %}
{% block content %}
<h1>Negocios</h1>
<div class="card">
  <form method="post">
    <h2>Agregar / Editar</h2>
    <div class="row">
      <div class="col">
        <label>ID (clave única)</label>
        <input name="id" placeholder="p.ej. BlackDog" value="{{ form.id or '' }}" required>
      </div>
      <div class="col">
        <label>Nombre público</label>
        <input name="name" placeholder="Nombre del negocio" value="{{ form.name or '' }}" required>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <div class="col">
        <label>Token (para el ESP32)</label>
        <input name="token" placeholder="p.ej. BlackDog-ESP32-LOCAL" value="{{ form.token or '' }}" required>
      </div>
      <div class="col">
        <label>Access Token de Mercado Pago</label>
        <input name="mp_access_token" placeholder="APP_USR-..." value="{{ form.mp_access_token or '' }}" required>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <div class="col">
        <label>Contraseña nueva (opcional)</label>
        <input name="password" type="password">
      </div>
      <div class="col">
        <label>Activo</label>
        <select name="active">
          <option value="true" {{ 'selected' if (form.active is not defined or form.active==True) else '' }}>Sí</option>
          <option value="false" {{ 'selected' if (form.active==False) else '' }}>No</option>
        </select>
      </div>
    </div>
    <div style="margin-top:12px">
      <button class="btn ok" type="submit">Guardar</button>
    </div>
  </form>
</div>

<div class="card" style="margin-top:16px">
  <table>
    <thead><tr><th>ID</th><th>Nombre</th><th>Token</th><th>Activo</th><th>Rol</th></tr></thead>
    <tbody>
      {% for k,u in users.items() %}
        <tr>
          <td>{{ k }}</td>
          <td>{{ u.name }}</td>
          <td class="muted">{{ u.token or '-' }}</td>
          <td>{% if u.active %}<span class="tag on">activo</span>{% else %}<span class="tag off">suspendido</span>{% endif %}</td>
          <td>{{ u.role }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
