{% extends "_base.html" %}
{% block content %}
<h2>Negocios</h2>

<div class="card">
  <h3>Agregar / Editar</h3>
  <form method="POST" action="/admin/save">
    <div class="grid2">
      <div>
        <label>ID (clave Ãºnica)</label>
        <input name="id" placeholder="p.ej. BlackDog">
        <label>Token (para el ESP32)</label>
        <input name="token" placeholder="p.ej. BlackDog-ESP32-LOCAL">
        <label>ContraseÃ±a nueva (opcional)</label>
        <input name="password" type="password">
      </div>
      <div>
        <label>Nombre pÃºblico</label>
        <input name="name" placeholder="Nombre del negocio">
        <label>Access Token de Mercado Pago</label>
        <input name="mp_access_token" placeholder="APP_USR-...">
        <label>Activo</label>
        <select name="active">
          <option value="true">SÃ­</option>
          <option value="false">No</option>
        </select>
      </div>
    </div>
    <button type="submit" class="btn ok">Guardar</button>
  </form>
</div>

<div class="card" style="margin-top:16px">
  <table>
    <thead><tr><th>ID</th><th>Nombre</th><th>Token</th><th>Activo</th><th>Rol</th><th>AcciÃ³n</th></tr></thead>
    <tbody>
      {% for k,u in users.items() %}
        <tr>
          <td>{{ k }}</td>
          <td>{{ u.name }}</td>
          <td class="muted">{{ u.token or '-' }}</td>
          <td>
            {% if u.active %}
              <span style="color:#00ff84;">ðŸŸ¢ Activo</span>
            {% else %}
              <span style="color:#ff3b3b;">ðŸ”´ Bloqueado</span>
            {% endif %}
          </td>
          <td>{{ u.role }}</td>
          <td>
            {% if u.active %}
              <a class="btn warn" href="{{ url_for('admin_toggle', neg_id=k) }}">Desactivar</a>
            {% else %}
              <a class="btn ok" href="{{ url_for('admin_toggle', neg_id=k) }}">Activar</a>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
