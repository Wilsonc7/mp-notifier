{% extends "_base.html" %}
{% block title %}Negocio · {{ business_id }}{% endblock %}

{% block content %}
<h2>{{ business.name }} <small style="opacity:.6">({{ business_id }})</small></h2>

<div class="cards">
  <div class="card">
    <h3>Hoy</h3>
    <p><b>${{ metrics.today.total }}</b> — {{ metrics.today.count }} pagos</p>
  </div>
  <div class="card">
    <h3>Semana</h3>
    <p><b>${{ metrics.week.total }}</b> — {{ metrics.week.count }} pagos</p>
  </div>
  <div class="card">
    <h3>Mes</h3>
    <p><b>${{ metrics.month.total }}</b> — {{ metrics.month.count }} pagos</p>
  </div>
</div>

<div style="margin: 6px 0 14px">
  <a class="btn" href="{{ url_for('admin_impersonate', biz_id=business_id) }}">Ver como este negocio</a>
  <a class="btn-ghost" href="{{ url_for('admin_dashboard') }}">Volver</a>
</div>

<canvas id="chartBiz" height="110"></canvas>

<h3 style="margin-top:24px">Últimos movimientos</h3>
<table class="table">
  <thead><tr><th>Fecha</th><th>Monto</th><th>Estado</th><th>Nombre</th><th>ID</th></tr></thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td>{{ r.fecha }}</td>
      <td>${{ r.monto }}</td>
      <td>{{ r.estado }}</td>
      <td>{{ r.nombre or '-' }}</td>
      <td style="font-size:.85em">{{ r.id }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const series = {{ metrics.series|tojson }};
new Chart(document.getElementById('chartBiz'), {
  type:'bar',
  data:{
    labels: series.map(x=>x.date),
    datasets:[{ label:'Total ($)', data: series.map(x=>x.total) }]
  },
  options:{ responsive:true, scales:{ y:{ beginAtZero:true } } }
});
</script>
{% endblock %}
